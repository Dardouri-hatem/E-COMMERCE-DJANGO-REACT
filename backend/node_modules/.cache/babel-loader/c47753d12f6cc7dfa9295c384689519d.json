{"ast":null,"code":"import _defineProperty from\"C:/Users/dardo/Desktop/e-commerce/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";import _objectSpread from\"C:/Users/dardo/Desktop/e-commerce/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"C:/Users/dardo/Desktop/e-commerce/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/dardo/Desktop/e-commerce/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/dardo/Desktop/e-commerce/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import React from\"react\";import{CardElement,useStripe,useElements}from\"@stripe/react-stripe-js\";import{Button,Form}from\"react-bootstrap\";import axios from\"axios\";import{connect}from\"react-redux\";import Select from\"react-select\";var CheckoutForm=function CheckoutForm(_ref){var success=_ref.success,user=_ref.user;var stripe=useStripe();var elements=useElements();var _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),countries=_React$useState2[0],setCountries=_React$useState2[1];var _React$useState3=React.useState({apartment_address:\"\",country:\"\",street_address:\"\",zip:\"\"}),_React$useState4=_slicedToArray(_React$useState3,2),address_data=_React$useState4[0],setData=_React$useState4[1];var handleFormatCountries=function handleFormatCountries(countries){var keys=Object.keys(countries);return keys.map(function(k){return{label:countries[k],value:k};});};React.useEffect(function(){axios.get(\"http://127.0.0.1:8000/products/country_list/\").then(function(res){return setCountries(handleFormatCountries(res.data));});},[]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(event){var _yield$stripe$createP,error,paymentMethod,user_id,config,_yield$axios$post,data;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:event.preventDefault();_context.next=3;return stripe.createPaymentMethod({type:\"card\",card:elements.getElement(CardElement)});case 3:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;if(error){_context.next=21;break;}user_id=user.id;_context.prev=8;config={headers:{\"Content-Type\":\"application/json\",Authorization:\"JWT \".concat(localStorage.getItem(\"access\")),Accept:\"application/json\"}};_context.next=12;return axios.post(\"http://127.0.0.1:8000/products/checkout/\",{payment_method_id:paymentMethod.id,user_id:user_id,zip:address_data.zip,street_address:address_data.street_address,apartement_address:address_data.apartment_address,country:address_data.country},config);case 12:_yield$axios$post=_context.sent;data=_yield$axios$post.data;console.log(data);success();_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](8);console.log(_context.t0);case 21:case\"end\":return _context.stop();}}},_callee,null,[[8,18]]);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();var handleChange=function handleChange(e){setData(_objectSpread(_objectSpread({},address_data),{},_defineProperty({},e.target.name,e.target.value)));};var handleSelectChange=function handleSelectChange(e,_ref3){var name=_ref3.name,value=_ref3.value;setData(_objectSpread(_objectSpread({},address_data),{},_defineProperty({},name,e.label)));};return/*#__PURE__*/_jsxs(\"div\",{className:\"w-50 m-5\",children:[/*#__PURE__*/_jsxs(Form,{children:[/*#__PURE__*/_jsx(\"h6\",{children:\"You need to add addresses before you can complete your purchase\"}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"formBasicEmail\",children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Street address\",name:\"street_address\",value:address_data.street_address,onChange:function onChange(e){return handleChange(e);}})}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"formBasicEmail\",children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Apartment address\",name:\"apartment_address\",value:address_data.apartment_address,onChange:function onChange(e){return handleChange(e);}})}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"formBasicEmail\",children:/*#__PURE__*/_jsx(Select,{options:countries,placeholder:\"Country\",name:\"country\",label:address_data.country,onChange:handleSelectChange})}),/*#__PURE__*/_jsx(Form.Group,{controlId:\"formBasicEmail\",children:/*#__PURE__*/_jsx(Form.Control,{type:\"text\",placeholder:\"Postal code\",name:\"zip\",value:address_data.zip,onChange:function onChange(e){return handleChange(e);}})})]}),/*#__PURE__*/_jsxs(\"form\",{className:\"mt-3 mr-5\",onSubmit:handleSubmit,style:{width:\"100%\"},children:[/*#__PURE__*/_jsx(\"h4\",{className:\"mb-3\",children:\"Would you complete your purchase ?\"}),/*#__PURE__*/_jsx(CardElement,{}),/*#__PURE__*/_jsx(Button,{className:\"mt-3\",type:\"submit\",disabled:!stripe,style:{width:\"100%\"},children:\"Pay\"})]})]});};var mapSTP=function mapSTP(state){return{user:state.account.user,cart:state.product.cart};};export default connect(mapSTP)(CheckoutForm);","map":{"version":3,"sources":["C:/Users/dardo/Desktop/e-commerce/frontend/src/components/Products/checkoutForm.js"],"names":["React","CardElement","useStripe","useElements","Button","Form","axios","connect","Select","CheckoutForm","success","user","stripe","elements","useState","countries","setCountries","apartment_address","country","street_address","zip","address_data","setData","handleFormatCountries","keys","Object","map","k","label","value","useEffect","get","then","res","data","handleSubmit","event","preventDefault","createPaymentMethod","type","card","getElement","error","paymentMethod","user_id","id","config","headers","Authorization","localStorage","getItem","Accept","post","payment_method_id","apartement_address","console","log","handleChange","e","target","name","handleSelectChange","width","mapSTP","state","account","cart","product"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { CardElement, useStripe, useElements } from \"@stripe/react-stripe-js\";\r\nimport { Button, Form } from \"react-bootstrap\";\r\nimport axios from \"axios\";\r\nimport { connect } from \"react-redux\";\r\nimport Select from \"react-select\";\r\n\r\nconst CheckoutForm = ({ success, user }) => {\r\n  const stripe = useStripe();\r\n  const elements = useElements();\r\n  const [countries, setCountries] = React.useState([]);\r\n  const [address_data, setData] = React.useState({\r\n    apartment_address: \"\",\r\n    country: \"\",\r\n    street_address: \"\",\r\n    zip: \"\",\r\n  });\r\n\r\n  const handleFormatCountries = (countries) => {\r\n    const keys = Object.keys(countries);\r\n    return keys.map((k) => {\r\n      return {\r\n        label: countries[k],\r\n        value: k,\r\n      };\r\n    });\r\n  };\r\n  React.useEffect(() => {\r\n    axios\r\n      .get(\"http://127.0.0.1:8000/products/country_list/\")\r\n      .then((res) => setCountries(handleFormatCountries(res.data)));\r\n  }, []);\r\n\r\n  const handleSubmit = async (event) => {\r\n    event.preventDefault();\r\n\r\n    const { error, paymentMethod } = await stripe.createPaymentMethod({\r\n      type: \"card\",\r\n      card: elements.getElement(CardElement),\r\n    });\r\n\r\n    if (!error) {\r\n      const user_id = user.id;\r\n      try {\r\n        const config = {\r\n          headers: {\r\n            \"Content-Type\": \"application/json\",\r\n            Authorization: `JWT ${localStorage.getItem(\"access\")}`,\r\n            Accept: \"application/json\",\r\n          },\r\n        };\r\n        const { data } = await axios.post(\r\n          `http://127.0.0.1:8000/products/checkout/`,\r\n          {\r\n            payment_method_id: paymentMethod.id,\r\n            user_id,\r\n            zip: address_data.zip,\r\n            street_address: address_data.street_address,\r\n            apartement_address: address_data.apartment_address,\r\n            country: address_data.country,\r\n          },\r\n          config\r\n        );\r\n        console.log(data);\r\n        success();\r\n      } catch (error) {\r\n        console.log(error);\r\n      }\r\n    }\r\n  };\r\n\r\n  const handleChange = (e) => {\r\n    setData({ ...address_data, [e.target.name]: e.target.value });\r\n  };\r\n  const handleSelectChange = (e, { name, value }) => {\r\n    setData({ ...address_data, [name]: e.label });\r\n  };\r\n\r\n  return (\r\n    <div className=\"w-50 m-5\">\r\n      <Form>\r\n        <h6>You need to add addresses before you can complete your purchase</h6>\r\n        <Form.Group controlId=\"formBasicEmail\">\r\n          <Form.Control\r\n            type=\"text\"\r\n            placeholder=\"Street address\"\r\n            name=\"street_address\"\r\n            value={address_data.street_address}\r\n            onChange={(e) => handleChange(e)}\r\n          />\r\n        </Form.Group>\r\n        <Form.Group controlId=\"formBasicEmail\">\r\n          <Form.Control\r\n            type=\"text\"\r\n            placeholder=\"Apartment address\"\r\n            name=\"apartment_address\"\r\n            value={address_data.apartment_address}\r\n            onChange={(e) => handleChange(e)}\r\n          />\r\n        </Form.Group>\r\n        <Form.Group controlId=\"formBasicEmail\">\r\n          <Select\r\n            options={countries}\r\n            placeholder=\"Country\"\r\n            name=\"country\"\r\n            label={address_data.country}\r\n            onChange={handleSelectChange}\r\n          />\r\n        </Form.Group>\r\n        <Form.Group controlId=\"formBasicEmail\">\r\n          <Form.Control\r\n            type=\"text\"\r\n            placeholder=\"Postal code\"\r\n            name=\"zip\"\r\n            value={address_data.zip}\r\n            onChange={(e) => handleChange(e)}\r\n          />\r\n        </Form.Group>\r\n      </Form>\r\n      <form\r\n        className=\"mt-3 mr-5\"\r\n        onSubmit={handleSubmit}\r\n        style={{ width: \"100%\" }}\r\n      >\r\n        <h4 className=\"mb-3\">Would you complete your purchase ?</h4>\r\n        <CardElement />\r\n        <Button\r\n          className=\"mt-3\"\r\n          type=\"submit\"\r\n          disabled={!stripe}\r\n          style={{ width: \"100%\" }}\r\n        >\r\n          Pay\r\n        </Button>\r\n      </form>\r\n    </div>\r\n  );\r\n};\r\nconst mapSTP = (state) => ({\r\n  user: state.account.user,\r\n  cart: state.product.cart,\r\n});\r\nexport default connect(mapSTP)(CheckoutForm);\r\n"]},"metadata":{},"sourceType":"module"}